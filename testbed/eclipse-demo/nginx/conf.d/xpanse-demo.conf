server {
    listen 443 ssl;
    listen [::]:443 ssl;
    http2 on;
    server_name xpanse-demo.eclipseprojects.io;

    ssl_certificate /etc/letsencrypt/live/xpanse-demo.eclipseprojects.io/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/xpanse-demo.eclipseprojects.io/privkey.pem;

    location = /app {
            return 301 /app/home;
        }

    location = /app/ {
             return 301 /app/home;
        }

    location / {
	    grpc_pass grpc://zitadel:8080;
	    grpc_set_header Host $host;
        }

    location ~ ^/(xpanse|swagger-ui|openapi|h2-console|v3|auth)(/|$) {
                proxy_pass http://xpanse:8080;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_set_header Host            $host;
                proxy_set_header X-Forwarded-Proto https;
                proxy_set_header X-Forwarded-Host $host;
                proxy_redirect  off;
        }
    location /grafana/ {
            proxy_set_header Host $host;
            rewrite ^/grafana/(.*) /$1 break;
            proxy_pass http://grafana:4000;
        }

    location ^~ /app/ {
            proxy_pass http://ui:3000/app/;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header Host $host;
        }
   # Redirect non-https traffic to https
   if ($scheme != "https") {
       return 301 https://$host$request_uri;
   } # managed by Certbot

}